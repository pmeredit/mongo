# -*- mode: python -*-

Import("env")

env = env.Clone()

env.Benchmark(
    target="op_observer_bm",
    source=[
        "op_observer_bm.cpp",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/db/auth/auth_op_observer",
        "$BUILD_DIR/mongo/db/auth/authserver",
        "$BUILD_DIR/mongo/db/repl/primary_only_service",
        "$BUILD_DIR/mongo/db/repl/replmocks",
        "$BUILD_DIR/mongo/db/repl/tenant_migration_donor_service",
        "$BUILD_DIR/mongo/db/repl/tenant_migration_recipient_service",
        "$BUILD_DIR/mongo/db/s/sharding_runtime_d",
        "$BUILD_DIR/mongo/db/service_context_d",
        "$BUILD_DIR/mongo/db/timeseries/timeseries_op_observer",
        "$BUILD_DIR/mongo/idl/cluster_server_parameter_op_observer",
        "change_stream_pre_images_op_observer",
        "fallback_op_observer",
        "fcv_op_observer",
        "find_and_modify_images_op_observer",
        "op_observer",
        "op_observer_impl",
        "op_observer_util",
        "operation_logger_impl",
        "operation_logger_transaction_proxy",
        "user_write_block_mode_op_observer",
    ],
    CONSOLIDATED_TARGET="repl_bm",
)

env.CppUnitTest(
    target="db_op_observer_test",
    source=[
        "batched_write_context_test.cpp",
        "batched_write_policy_test.cpp",
        "op_observer_impl_test.cpp",
        "op_observer_registry_test.cpp",
        "user_write_block_mode_op_observer_test.cpp",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/db/auth/authmocks",
        "$BUILD_DIR/mongo/db/catalog/catalog_helpers",
        "$BUILD_DIR/mongo/db/catalog/import_collection_oplog_entry",
        "$BUILD_DIR/mongo/db/catalog/local_oplog_info",
        "$BUILD_DIR/mongo/db/change_stream_pre_images_collection_manager",
        "$BUILD_DIR/mongo/db/commands/create_command",
        "$BUILD_DIR/mongo/db/concurrency/exception_util",
        "$BUILD_DIR/mongo/db/dbdirectclient",
        "$BUILD_DIR/mongo/db/read_write_concern_defaults",
        "$BUILD_DIR/mongo/db/read_write_concern_defaults_mock",
        "$BUILD_DIR/mongo/db/repl/image_collection_entry",
        "$BUILD_DIR/mongo/db/repl/oplog",
        "$BUILD_DIR/mongo/db/repl/oplog_interface_local",
        "$BUILD_DIR/mongo/db/repl/replmocks",
        "$BUILD_DIR/mongo/db/repl/storage_interface_impl",
        "$BUILD_DIR/mongo/db/repl/tenant_migration_access_blocker",
        "$BUILD_DIR/mongo/db/service_context_d_test_fixture",
        "$BUILD_DIR/mongo/db/session/session_catalog_mongod",
        "$BUILD_DIR/mongo/db/shard_role",
        "$BUILD_DIR/mongo/db/storage/recovery_unit_base",
        "$BUILD_DIR/mongo/db/storage/storage_options",
        "$BUILD_DIR/mongo/db/transaction/transaction",
        "$BUILD_DIR/mongo/db/transaction/transaction_operations",
        "$BUILD_DIR/mongo/db/write_block_bypass",
        "batched_write_context",
        "change_stream_pre_images_op_observer",
        "find_and_modify_images_op_observer",
        "op_observer",
        "op_observer_impl",
        "op_observer_util",
        "operation_logger_impl",
        "user_write_block_mode_op_observer",
    ],
)
