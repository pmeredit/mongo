# -*- mode: python -*-

Import("env")
Import("has_option")
Import("get_option")

env = env.Clone()

env.SConscript(
    must_exist=1,
    dirs=[
        "query_cmd",
    ],
    exports=[
        "env",
    ],
)

env.CppUnitTest(
    target="command_mirroring_test",
    source=[
        "command_mirroring_test.cpp",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/base",
        "$BUILD_DIR/mongo/db/auth/authmocks",
        "$BUILD_DIR/mongo/db/auth/authorization_manager_global",
        "$BUILD_DIR/mongo/db/commands",
        "$BUILD_DIR/mongo/db/service_context_non_d",
        "$BUILD_DIR/mongo/unittest/unittest",
        "standalone",
    ],
)

env.CppUnitTest(
    target="async_command_execution_test",
    source=[
        "async_command_execution_test.cpp",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/base",
        "$BUILD_DIR/mongo/db/auth/authmocks",
        "$BUILD_DIR/mongo/db/auth/authorization_manager_global",
        "$BUILD_DIR/mongo/db/commands",
        "$BUILD_DIR/mongo/db/commands/standalone",
        "$BUILD_DIR/mongo/db/service_context_non_d",
        "$BUILD_DIR/mongo/db/service_context_test_fixture",
        "$BUILD_DIR/mongo/util/version_impl",
    ],
)

env.CppUnitTest(
    target="db_commands_test",
    source=[
        "create_command_test.cpp",
        "create_indexes_test.cpp",
        "dbcheck_command_test.cpp",
        "fle_compact_test.cpp",
        "list_collections_filter_test.cpp",
        "parse_log_component_settings_test.cpp",
        "query_cmd/explain_test.cpp",
        "query_cmd/external_data_source_commands_test.cpp",
        "query_cmd/aggregation_execution_state_test.cpp",
        "query_cmd/index_filter_commands_test.cpp",
        "query_cmd/mr_test.cpp" if get_option("js-engine") != "none" else [],
        "query_cmd/plan_cache_commands_test.cpp",
        "server_status_command_test.cpp",
        "server_status_metric_test.cpp",
        "set_cluster_parameter_invocation_test.cpp",
        "set_profiling_filter_globally_cmd_test.cpp",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/crypto/aead_encryption",
        "$BUILD_DIR/mongo/crypto/encrypted_field_config",
        "$BUILD_DIR/mongo/crypto/fle_crypto",
        "$BUILD_DIR/mongo/db/auth/authmocks",
        "$BUILD_DIR/mongo/db/catalog/catalog_test_fixture",
        "$BUILD_DIR/mongo/db/catalog/health_log",
        "$BUILD_DIR/mongo/db/collection_crud/collection_crud",
        "$BUILD_DIR/mongo/db/concurrency/exception_util",
        "$BUILD_DIR/mongo/db/dbdirectclient",
        "$BUILD_DIR/mongo/db/fle_crud",
        "$BUILD_DIR/mongo/db/fle_mocks",
        "$BUILD_DIR/mongo/db/index_builds/index_builds_coordinator",
        "$BUILD_DIR/mongo/db/multitenancy",
        "$BUILD_DIR/mongo/db/op_observer/op_observer",
        "$BUILD_DIR/mongo/db/query/query_planner",
        "$BUILD_DIR/mongo/db/query/query_test_service_context",
        "$BUILD_DIR/mongo/db/query/virtual_collection/virtual_collection",
        "$BUILD_DIR/mongo/db/query_exec",
        "$BUILD_DIR/mongo/db/repl/dbcheck_test_fixture",
        "$BUILD_DIR/mongo/db/repl/replmocks",
        "$BUILD_DIR/mongo/db/repl/storage_interface_impl",
        "$BUILD_DIR/mongo/db/service_context_d_test_fixture",
        "$BUILD_DIR/mongo/db/shard_role",
        "$BUILD_DIR/mongo/db/storage/record_store_base",
        "$BUILD_DIR/mongo/idl/idl_parser",
        "$BUILD_DIR/mongo/shell/kms_idl",
        "$BUILD_DIR/mongo/util/version_impl",
        "cluster_server_parameter_commands_invocation",
        "core",
        "create_command",
        "dbcheck_command",
        "list_collections_filter",
        "mongod",
        "profile_common",
        "server_status_core",
        "servers",
        "standalone",
    ],
)
