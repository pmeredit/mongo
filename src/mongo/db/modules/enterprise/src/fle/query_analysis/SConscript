# -*- mode: python -*-

Import("env")

env = env.Clone()

env.Library(
    target="query_analysis",
    source=[
        "agg_expression_encryption_intender_base.cpp",
        "aggregate_expression_intender.cpp",
        "aggregate_expression_intender_entry.cpp",
        "aggregate_expression_intender_range.cpp",
        "collator_factory_cryptd.cpp",
        "encryption_schema_tree.cpp",
        "expression_schema_walker.cpp",
        "fle_match_expression.cpp",
        "fle_pipeline.cpp",
        "query_analysis.cpp",
        "resolved_encryption_info.cpp",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/base",
        "$BUILD_DIR/mongo/crypto/encrypted_field_config",
        "$BUILD_DIR/mongo/crypto/fle_crypto",
        "$BUILD_DIR/mongo/crypto/fle_fields",
        "$BUILD_DIR/mongo/db/coll_mod_command_idl",
        "$BUILD_DIR/mongo/db/commands",
        "$BUILD_DIR/mongo/db/commands/bulk_write_common",
        "$BUILD_DIR/mongo/db/commands/create_command",
        "$BUILD_DIR/mongo/db/index_commands_idl",
        "$BUILD_DIR/mongo/db/ops/write_ops_parsers",
        "$BUILD_DIR/mongo/db/pipeline/accumulator",
        "$BUILD_DIR/mongo/db/pipeline/change_stream_pipeline",
        "$BUILD_DIR/mongo/db/pipeline/pipeline",
        "$BUILD_DIR/mongo/db/query/command_request_response",
        "$BUILD_DIR/mongo/db/query/query_planner",
        "$BUILD_DIR/mongo/db/query/query_request",
        "$BUILD_DIR/mongo/db/query_exec",
        "$BUILD_DIR/mongo/db/query_expressions",
        "$BUILD_DIR/mongo/db/shard_role_api",
        "$BUILD_DIR/mongo/db/update/update_driver",
        "$BUILD_DIR/mongo/util/pcre_wrapper",
    ],
)

env.CppUnitTest(
    target="enterprise_fle_query_analysis_test",
    source=[
        "aggregate_expression_intender_range_test.cpp",
        "aggregate_expression_intender_test.cpp",
        "encryption_schema_tree_test.cpp",
        "expression_analysis_test.cpp",
        "fle2_test_fixture.cpp",
        "fle_match_expression_test.cpp",
        "fle_pipeline_test.cpp",
        "fle_test_fixture.cpp",
        "query_analysis_test.cpp",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/db/auth/authmocks",
        "$BUILD_DIR/mongo/db/query/query_test_service_context",
        "$BUILD_DIR/mongo/db/service_context_non_d",
        "$BUILD_DIR/mongo/db/service_context_test_fixture",
        "query_analysis",
    ],
)
