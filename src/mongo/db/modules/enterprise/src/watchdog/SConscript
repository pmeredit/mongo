# -*- mode: python -*-

Import('env')

if not env.TargetOSIs("darwin"):
    env.Library(
        target='watchdog',
        source=[
            'watchdog.cpp',
        ],
        LIBDEPS=[
            '$BUILD_DIR/mongo/base',
            '$BUILD_DIR/mongo/db/service_context',
            '$BUILD_DIR/mongo/db/storage/storage_options',
        ]
    )


    env.Library(
        target='watchdog_mongod',
        source=[
            'watchdog_mongod.cpp',
            env.Idlc('watchdog_mongod.idl')[0],
        ],
        LIBDEPS=[
            '$BUILD_DIR/mongo/db/commands/server_status',
            '../../audit_enterprise',
            'watchdog',
         ],
        LIBDEPS_PRIVATE=[
            '$BUILD_DIR/mongo/db/server_options_core',
            '$BUILD_DIR/mongo/idl/server_parameter',
         ],
        PROGDEPS_DEPENDENTS=[
            '$BUILD_DIR/mongo/mongod',
        ]
    )

    env.CppUnitTest(
        target='watchdog_test',
        source=[
            'watchdog_test.cpp',
        ],
        LIBDEPS=[
            '$BUILD_DIR/mongo/db/service_context_test_fixture',
            '$BUILD_DIR/mongo/util/clock_source_mock',
            'watchdog',
        ],
    )
