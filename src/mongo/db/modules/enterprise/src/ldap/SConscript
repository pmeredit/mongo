# -*- mode: python -*-

Import(["env", "http_client"])

env = env.Clone()

env.Library(
    target="mongo_ldap",
    source=[
        "authorization_backend_ldap.cpp",
        "ldap_user_cache_poller_gen.cpp",
        "ldap_user_cache_poller.cpp",
    ],
    LIBDEPS_PRIVATE=[
        "$BUILD_DIR/mongo/bson/mutable/mutable_bson",
        "$BUILD_DIR/mongo/db/auth/auth",
        "$BUILD_DIR/mongo/db/auth/auth_impl_internal",
        "$BUILD_DIR/mongo/db/auth/authserver",
        "$BUILD_DIR/mongo/db/server_base",
        "$BUILD_DIR/mongo/util/background_job",
        "ldap_manager_impl",
        "ldap_name_map",
        "ldap_query",
    ],
)

env.CppUnitTest(
    target="enterprise_ldap_test",
    source=[
        "ldap_connection_options_test.cpp",
        "ldap_health_observer_test.cpp",
        "ldap_query_test.cpp",
        "name_mapping/rewrite_rule_test.cpp",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/db/auth/auth",
        "$BUILD_DIR/mongo/db/process_health/fault_manager",
        "$BUILD_DIR/mongo/db/service_context",
        "$BUILD_DIR/mongo/executor/task_executor_test_fixture",
        "$BUILD_DIR/mongo/executor/thread_pool_task_executor_test_fixture",
        "$BUILD_DIR/mongo/util/clock_source_mock",
        "../util/core_options_stub",
        "ldap_health_observer",
        "ldap_manager_impl",
        "ldap_name_map",
        "ldap_query",
    ],
)

env.Program(
    target="mongoldap",
    source=[
        "ldap_tool.cpp",
        "ldap_tool_options.cpp",
        "ldap_tool_options_gen.cpp",
    ]
    + env.WindowsResourceFile("ldap_tool.rc"),
    AIB_COMPONENT="mongoldap",
    AIB_COMPONENTS_EXTRA=[
        "dist",
        "dist-test",
        "tools",
    ],
    LIBDEPS=[
        "$BUILD_DIR/mongo/base",
        "$BUILD_DIR/mongo/base/secure_allocator",
        "$BUILD_DIR/mongo/client/native_sasl_client",
        "$BUILD_DIR/mongo/db/log_process_details",
        "$BUILD_DIR/mongo/db/service_context_non_d",
        "$BUILD_DIR/mongo/util/dns_query",
        "$BUILD_DIR/mongo/util/net/http_client_impl",
        "$BUILD_DIR/mongo/util/options_parser/options_parser_init",
        "$BUILD_DIR/mongo/util/signal_handlers",
        "$BUILD_DIR/mongo/util/version_impl",
        "../util/report_tool",
        "ldap_manager",
        "ldap_manager_impl",
        "ldap_options_mongod",
        "ldap_query",
    ],
)
