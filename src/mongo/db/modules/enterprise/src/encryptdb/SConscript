# -*- mode: python -*-
Import("env")
Import("wiredtiger")
Import("get_option")

env = env.Clone()

if not wiredtiger:
    env.FatalError("EncryptedStorage requires WiredTiger")

env.CppUnitTest(
    target="enterprise_encryptdb_test",
    source=[],
    LIBDEPS=[],
)

using_ubsan = False
sanitizer_list = get_option("sanitize")
if sanitizer_list:
    using_ubsan = "undefined" in sanitizer_list.split(",")

if not using_ubsan:
    env.CppUnitTest(
        target="enterprise_encryptdb_noubsan_test",
        source=[],
        LIBDEPS=[],
    )

env.BazelProgram(
    target="mongodecrypt",
    source=[],
    AIB_COMPONENT="mongodecrypt",
    AIB_COMPONENTS_EXTRA=[
        "dist",
        "dist-test",
        "tools",
    ],
)
